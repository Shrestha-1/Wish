<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Birthday ğŸ‰</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Great+Vibes&display=swap" rel="stylesheet" />
 <link rel="stylesheet" href="birthday.css" />
</head>
<body>
  <div class="stars"></div>
  <div id="confetti"></div>

  <header>
    <div>
      <div class="title">Happy Birthday ğŸ‚</div>
      <div class="subtitle">Sending surprises across the miles âœ¨</div>
    </div>
  </header>

  <main class="card">
    <section class="panel">
      <div class="hero-emoji">ğŸ‰ ğŸ‚ âœ¨ ğŸ’– ğŸ ğŸŒ¸ ğŸŒŸ </div>
      <p class="dear" id="dear-text"></p>
      <p class="wish" id="wish-text"></p>
<div class="signature" id="signature-text"></div>

    </section>

    <section class="panel">
      <h2 style="margin: 0 0 10px 0; font-size: 22px; text-align: center;">
        Countdown to your birthday, miss ğŸ’–
      </h2>
      <div class="countdown">
        <div class="timebox">
          <div class="num" id="days">--</div>
          <div class="lab">Days</div>
        </div>
        <div class="timebox">
          <div class="num" id="hours">--</div>
          <div class="lab">Hours</div>
        </div>
        <div class="timebox">
          <div class="num" id="mins">--</div>
          <div class="lab">Minutes</div>
        </div>
        <div class="timebox">
          <div class="num" id="secs">--</div>
          <div class="lab">Seconds</div>
        </div>
      </div>
      <div id="celebration" aria-live="polite" role="alert" aria-atomic="true" aria-relevant="additions">
        <span>ğŸ‚</span>
        <span>ğŸˆ</span>
        <span>ğŸ’–</span>
        <span>ğŸ‰</span>
        <span>ğŸ</span>
        <span>ğŸ¥³</span>
        <span>ğŸˆ</span>
        <span>ğŸ’–</span>
        <span>ğŸ‚</span>
      </div>
    </section>

    <section class="panel footer">
      <div>Made with love, emojis, and a little bit of stardust âœ¨</div>
    </section>
  </main>

  <script>
  // ===============================
  // GLOBAL STATE
  // ===============================
  let targetUTC = null;
  let countdownInterval = null;
  let celebrationTimeout = null;

  // ===============================
  // TIME (UTC) LOGIC
  // ===============================
  async function getAccurateUTC() {
    try {
      const res = await fetch("https://worldtimeapi.org/api/timezone/Etc/UTC");
      const json = await res.json();
      return new Date(json.utc_datetime);
    } catch (e1) {
      try {
        const res2 = await fetch("https://timeapi.io/api/Time/current/zone?timeZone=UTC");
        const json2 = await res2.json();
        return new Date(json2.dateTime);
      } catch (e2) {
        console.warn("UTC APIs failed. Falling back to device time.");
        return new Date();
      }
    }
  }

  // ===============================
  // DOM REFERENCES
  // ===============================
  const dEl = document.getElementById("days");
  const hEl = document.getElementById("hours");
  const mEl = document.getElementById("mins");
  const sEl = document.getElementById("secs");

  const celebrationSection = document.getElementById("celebration");
  const celebrationSpans = celebrationSection.querySelectorAll("span");

  // ===============================
  // CELEBRATION EMOJI PREP
  // ===============================
  function prepareCelebrationEmojis() {
    celebrationSpans.forEach(span => {
      const sway = Math.random() * 30 - 15;
      const delay = Math.random() * 5;
      span.style.setProperty("--sway", sway + "px");
      span.style.animationDelay = delay + "s";
    });
  }

  prepareCelebrationEmojis();

  // ===============================
  // COUNTDOWN LOGIC
  // ===============================
  async function updateCountdown() {
    if (!targetUTC) return;

    const utcNow = await getAccurateUTC();
    const diff = targetUTC - utcNow;

    if (diff <= 0) {
      dEl.textContent = "0";
      hEl.textContent = "00";
      mEl.textContent = "00";
      sEl.textContent = "00";

      celebrationSection.style.visibility = "visible";
      celebrationSection.style.opacity = "1";

      if (celebrationTimeout) clearTimeout(celebrationTimeout);
      celebrationTimeout = setTimeout(() => {
        celebrationSection.style.opacity = "0";
        celebrationSection.style.visibility = "hidden";
      }, 10000);

      return;
    }

    const totalSec = Math.floor(diff / 1000);
    const days = Math.floor(totalSec / 86400);
    const hours = Math.floor((totalSec % 86400) / 3600);
    const mins = Math.floor((totalSec % 3600) / 60);
    const secs = totalSec % 60;

    dEl.textContent = days;
    hEl.textContent = hours.toString().padStart(2, "0");
    mEl.textContent = mins.toString().padStart(2, "0");
    sEl.textContent = secs.toString().padStart(2, "0");

    celebrationSection.style.opacity = "0";
    celebrationSection.style.visibility = "hidden";
  }

  // ===============================
  // CONFETTI LOGIC
  // ===============================
  const confettiContainer = document.getElementById("confetti");
  let backgroundConfettiPieces = [];

  function createConfettiPiece({ left, duration, delay, size, rotate, infinite }) {
    const span = document.createElement("span");
    span.className = "confetti-piece";
    span.style.left = left + "vw";
    span.style.width = size + "px";
    span.style.height = size * 1.8 + "px";
    span.style.backgroundColor = `hsl(${Math.random() * 360}, 90%, 70%)`;
    span.style.setProperty("--rot", rotate + "deg");
    span.style.animationDuration = duration + "s";
    span.style.animationDelay = delay + "s";
    span.style.animationIterationCount = infinite ? "infinite" : "1";
    confettiContainer.appendChild(span);

    if (!infinite) {
      span.addEventListener("animationend", () => span.remove());
    }

    return span;
  }

  function createInitialBurst() {
    for (let i = 0; i < 30; i++) {
      createConfettiPiece({
        left: Math.random() * 100,
        duration: 3 + Math.random() * 2,
        delay: Math.random() * 2,
        size: 8 + Math.random() * 6,
        rotate: Math.random() * 360,
        infinite: false
      });
    }
  }

  function createBackgroundConfetti() {
    backgroundConfettiPieces.forEach(p => p.remove());
    backgroundConfettiPieces = [];

    for (let i = 0; i < 10; i++) {
      backgroundConfettiPieces.push(
        createConfettiPiece({
          left: Math.random() * 100,
          duration: 15 + Math.random() * 15,
          delay: -Math.random() * 10,
          size: 6 + Math.random() * 5,
          rotate: Math.random() * 360,
          infinite: true
        })
      );
    }
  }

  function startConfettiFlow() {
    if (!localStorage.getItem("birthdayConfettiDone")) {
      createInitialBurst();
      setTimeout(() => {
        createBackgroundConfetti();
        localStorage.setItem("birthdayConfettiDone", "true");
      }, 10000);
    } else {
      createBackgroundConfetti();
    }
  }

  startConfettiFlow();

  // ===============================
  // LOAD BIRTHDAY DATA
  // ===============================
  async function loadBirthdayData() {
    const name = sessionStorage.getItem("birthdayName");

    if (!name) {
      document.body.innerHTML =
        '<div style="color:yellow;text-align:center;margin-top:50px;">Name not found.</div>';
      return;
    }

    try {
      const res = await fetch("birthdays.json");
      const data = await res.json();

      const person = data.find(
        p => p.name.toLowerCase() === name.toLowerCase()
      );

      if (!person) {
        document.body.innerHTML =
          `<div style="color:yellow;text-align:center;margin-top:50px;">${name} not found.</div>`;
        return;
      }

      document.querySelector(".title").textContent =
        `Happy Birthday ${person.name} ğŸ‚`;
      document.getElementById('dear-text').textContent = `Dear ${person.name},`;
document.getElementById('wish-text').textContent = person.wish;
document.getElementById("signature-text").textContent = person.signature;

      targetUTC = new Date(person.date);
      updateCountdown();

      if (countdownInterval) clearInterval(countdownInterval);
      countdownInterval = setInterval(updateCountdown, 1000);

    } catch (err) {
      console.error(err);
      document.body.innerHTML =
        '<div style="color:yellow;text-align:center;margin-top:50px;">Error loading data.</div>';
    }
  }

  loadBirthdayData();
</script>
</body>
</html>
